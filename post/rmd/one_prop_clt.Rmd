
---
title: "Inference for a single proportion"
output:
  html_notebook:
    toc: yes
editor_options: 
  chunk_output_type: inline
---

Load tidyverse package and set plot theme
```{r load_libraries, message = F}
library(tidyverse)

theme_set(theme_classic(base_size = 16))
```

Set up data, make sure everything checks out
```{r data}
correct <- 571
incorrect <- 99
N <- correct + incorrect


p <- correct/N
p
```


Let's build our estimate of what the sampling distribution would be like
```{r sampling}
empirical_sample <- c(rep("Correct", correct), rep("Incorrect", incorrect))

glimpse(empirical_sample)

sample_func <- function(){
  hypothetical_sample <- sample(empirical_sample, N, replace = TRUE)
  mean(hypothetical_sample == "Correct")
}

sample_func()
```


We expect from CLT that p_hat ~ Normal(p, sqrt((p*1-p)/n))

What does it's shape look like?
```{r sample_plots}
sample_means <- data_frame(sample = 1:10000,
                           mean = replicate(10000,sample_func()))

ggplot(sample_means, aes(x = mean)) + 
  geom_histogram(binwidth = .0075)
```

What do it's parameters look like?
```{r estimate_params}
sample_means <- data_frame(sample = 1:10000,
                           mean = replicate(10000,sample_func()))

pop_mean_estimate <- mean(sample_means$mean)
pop_mean_estimate

sample_mean_sd <- sd(sample_means$mean)
sample_mean_sd

predicted_mean_sd <- sqrt((correct/N)*(incorrect/N)/N)
predicted_mean_sd
```

Let's look at confidence intervals
```{r ci_plot}
sample_means <- data_frame(sample = 1:10000,
                           mean = replicate(10000,sample_func()))

ggplot(sample_means, aes(x = mean)) + 
  geom_histogram(binwidth = .0075) + 
  geom_vline(aes(xintercept = quantile(sample_means$mean,.025)), 
             color = "darkred", size = 2) +
  geom_vline(aes(xintercept = quantile(sample_means$mean,.975)), 
             color = "darkred", size = 2)

```


Let's get confidence intervals 
```{r estimate_cis}
sample_means <- data_frame(sample = 1:10000,
                           mean = replicate(10000,sample_func()))

sample_mean_quantiles <- quantile(sample_means$mean, probs = c(.025, .975))
sample_mean_quantiles


predicted_mean_quantiles <- c((correct/N) - 1.96 * 
                                sqrt((correct/N) *(incorrect/N)/N),
                              (correct/N) + 1.96 *
                                sqrt((correct/N) *(incorrect/N)/N))

predicted_mean_quantiles
```


Why p_hat = .5 is conservative
```{r p_hat_check}

p_check <- data_frame(p = seq(0, 1, .01)) %>%
  mutate(estimate = p * (1-p))

glimpse(p_check)

ggplot(data = p_check, aes(x = p, y = estimate)) +
  geom_point()

```

Hypothesis testing with CIs. First use Sampling.
```{r estimate_null_cis}
correct <- 571
incorrect <- 99
N <- correct + incorrect
p <- correct/N
p


chance_p <- .8

null_correct <- chance_p * N
null_incorrect <- (1-chance_p) * N

null_sample <- c(rep("Correct", null_correct), rep("Incorrect", null_incorrect))

head(null_sample)

null_func <- function(){
  hypothetical_sample <- sample(null_sample, N, replace = TRUE)
  mean(hypothetical_sample == "Correct")
}

null_func()

null_means <- data_frame(sample = 1:10000,
                         mean = replicate(10000,null_func()))

ggplot(null_means, aes(x = mean)) + 
  geom_histogram(binwidth = .0075)


null_quantiles <- quantile(null_means$mean, probs = c(.025, .975))
null_quantiles

null_correct
```

Now use CLT
```{r clt_null_cis}
chance_p <- .8

null_correct <- chance_p * N
null_incorrect <- (1-chance_p) * N


predicted_null_quantiles <- c((null_correct/N) - 1.96 * 
                                sqrt((null_correct/N) *(null_incorrect/N)/N),
                              (null_correct/N) + 1.96 * 
                                sqrt((null_correct/N) *(null_incorrect/N)/N))

predicted_null_quantiles

```






